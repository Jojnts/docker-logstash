input {
  http {
    port => 12201
  }
}

filter {
  if [headers][request_method] != "POST" {
    # On Aptible, we've configured the logdrain to pass logs to logstash
    # over HTTPS. Logs are passed via POST requests.
    #
    # Drop all non-POST requests. Healthchecks happen over HTTP GET,
    # and we don't want those getting into Logstash.
    drop { }
  }

  json {
    source => 'log'
    skip_on_invalid_json => true
  }
}

output {
  elasticsearch {
    hosts => "${ELASTICSEARCH_URL}"
    timeout => 600
  }
}
